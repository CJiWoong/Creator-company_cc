<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC	"-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="kr.co.cc.archive.dao.ArchiveDAO">

	<select id="archivelist" resultType="kr.co.cc.archive.dto.ArchiveDTO">
   		SELECT * FROM  archive_board WHERE status = 1
   	</select>
	
	<!-- 자료실 작성 -->
	<insert 
	    id="archiveWrite" 
	    parameterType="kr.co.cc.archive.dto.ArchiveDTO" 
	    useGeneratedKeys="false">
	    <selectKey keyProperty="id" resultType="java.lang.String" order="BEFORE">
	        SELECT UUID()
	    </selectKey>
	    INSERT INTO archive_board (id, member_id, category, subject, content, hit, status)	
	    VALUES (#{id}, #{member_id}, #{category}, #{subject}, #{content}, 0, 1)
	</insert>



	<!-- 파일 첨부 -->
	<insert id="archivefileWrite">
		INSERT INTO attachment(ori_file_name, id, classification, identify_value)
			VALUES(#{param1}, #{param2}, #{param3}, #{param4})
	</insert>

<!-- 자료실 상세보기 -->
<select id="archivedetail" resultType="kr.co.cc.archive.dto.ArchiveDTO">
    select ab.id, ab.member_id, ab.category, ab.subject, ab.content, ab.hit, ab.create_at, m.dept_id, m.name
    from archive_board ab
    join member m on ab.member_id = m.id
    where ab.id = #{id}
</select>


	<!-- 조회수 상승 -->
	<update id="upHit">
		UPDATE archive_board SET hit = hit + 1 WHERE id = #{id}
	</update>	
	
	<!-- 자료실 상세보기 (파일) -->
	<select id="archiveDetailFile" resultType="kr.co.cc.doc.dto.AttachmentDTO">
		SELECT* FROM attachment WHERE identify_value = #{id}
	</select>


	<update id="archiveUpdate" parameterType="hashmap">
		UPDATE archive_board SET 
		subject = #{subject}
		,content = #{content}
		WHERE id = #{id}
	</update>


	<delete id="removeFileName" parameterType="String">
		DELETE FROM attachment WHERE new_photo_name = #{fileName} AND classification = '자료실'
	</delete>

	<update id="archivedelete" parameterType="java.lang.String">
		UPDATE archive_board SET status = 0 WHERE status = 1 and id = #{id}
	</update>	

</mapper>